# makefile for GENRAY-C using franklin.nersc.gov pgi compiler
# Predecessor makefile: N.Ershov 
# 24 Jan, 2003   # Revised/adapted for genray-c by Yuri Petrov May-2011
# USAGE: 
# make 		- as usual make
# make rebuild	- rebuild whole program
# make clean	- remove all *.o files

SHELL=		/bin/sh
NAME=		xgenray
COMPILER=	gfortran
BUILDER=	$(COMPILER)
INCLUDES=	antenna.i cefield.i cone.i eps.i\
		five.i fourb.i gr.i grill.i ions.i\
		limit.i nperpcom.i\
		name.i name_eccone.i name_genr.i name_grill.i \
		name_non_uniform_mesh_profiles_line.i\
		name_tokamak.i name_uniform_mesh_profiles.i\
		output.i one.i \
		onetwo.i oxb.i\
		rho.i six.i three.i \
		write.i writencdf.i \
		commons.i param.i  rrange.i n_parb.i rkutta.i\
		globcd.h globcd1.h globcd2.h \
		netcdf.inc
SOURCES=	genray.f  abc.f   absorpfw.f absorplh.f   arrays.f\
		abhay_disp.f\
		b.f  bcast.f besk.f besk2as.f bessel.f   bound.f\
		bess_slatec.f besvec.f cn.f\
		chamber_wall.f \
		cninit.f   cnpermuz.f  coldm.f  cone_ec.f\
		contour.f croot.f curba_GA.f\
		combine_disp.f \
                dddrz1.f dense.f dinit.f\
		dmnf.f dten16.f dxdphi.f   dxdr.f   dxdz.f\
		dydphi.f   dydr.f   dydz.f   efield1.f\
		equilib.f  eric_disp.f \
		flown.f  forest.f gamma.f\
		gr2new.f    gr3.f grill_lh.f   hamilmuz.f   hamilt1.f\
		lin_liu_curnt.f lh_ql_flux.f \
		mathcurb.f   mk_graph.f mmdei.f  mullerfun2.f  ninit_ec.f \
		nist_drd.f  netcdfr3d.f \
		outinit.f   output.f  outputb1.f  ono_disp.f oxb.f\
		plasmray.f   \
		prep3d.f  prepripl.f  rhospl.f   rk_new.f\
		read_write_genray_input.f\
		rside1.f  relat_tens.f \
		s.f   sdr1.f   spline.f spldens.f\
		slatec_ram.f\
		stop.f tensrcld.f\
		uertst.f   ugetio.f   uspkd.f\
		write3d.f x.f   y.f wconvini.f zcunix.f\
		zfunc.f   zr_psith.f zfun_cur.f  xyz.f dddrz1_xyz.f
OBJECTS=	$(SOURCES:.f=.o)
F90SRCS=	kind_spec.f90
F90OBJS=	$(F90SRCS:.f90=.o)
LOCATION=	-L/usr/lib/X11  -L/usr/local/pgplot
#LOCATION  =  -L/usr/local/netcdf-3.5.0/lib -L/usr/X11R6/lib -L/usr/local/pgplot  -L/usr/X11R6/lib -L/usr/lib/gcc-lib/i386-redhat-linux/2.96
#LIBRARIES=	-lX11 -lnetcdf -lpgplot

LIBRARIES=	-lX11 -lnetcdff -lnetcdf -lpgplot
#LIBRARIES=	-lX11 -lnetcdf -lpgplot -lnetcdf  -lm -llapack -lblas -lg2c
INCLUDE=/usr/include
DEBUG=		
#BH100214:  -ieee not working with gfortran? CSPECIAL= -ieee -frecord-marker=4	
CSPECIAL= -frecord-marker=4	
BSPECIAL=	

#COMPILE=	$(COMPILER) -c $(CSPECIAL) $(DEBUG) -I $(INCLUDE)
COMPILE=	$(COMPILER) -c $(CSPECIAL) -I $(INCLUDE)
#BUILD=		$(BUILDER) -o $(NAME) $(BSPECIAL) $(DEBUG)
BUILD=		$(BUILDER) -o $(NAME) $(BSPECIAL)
PROTECT=	chmod 755
DELETE=		rm -f

$(NAME):	$(F90OBJS) $(OBJECTS)
	$(BUILD) $(F90OBJS) $(OBJECTS) $(LOCATION) $(LIBRARIES)
	$(PROTECT) $(NAME)

$(F90OBJS): %.o: %.f90
	$(COMPILE) $< -o $@

$(OBJECTS): %.o: %.f 
	$(COMPILE) $< -o $@

rebuild:
	$(COMPILE) $(SOURCES) $(F90SRCS)
	$(BUILD) $(OBJECTS) $(F90OBJS) $(LOCATION) $(LIBRARIES)
	$(PROTECT) $(NAME)

clean:
	$(DELETE) $(OBJECTS) $(F90OBJS) *.mod

#end

